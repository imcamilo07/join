-- =========================================
-- AUTO SERVER SCANNER + JOIN (FINAL)
-- =========================================

local player = game.Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui")

-- ===== CONFIG =====
local MAX_SERVERS_SCAN = 5
local AUTO_ENABLED = false
local lastJoinedValue = nil

-- ===== PET MENU =====
local petMenu = gui:WaitForChild("PetMenu")
local mainFrame = petMenu:WaitForChild("Frame")
local scrolling = mainFrame:WaitForChild("ScrollingFrame")

print("[Auto] Script listo. Refresca manualmente.")

-- ===== UTIL =====
local function parseValue(text)
	if not text then return 0 end
	text = tostring(text):upper():gsub(" ", "")

	local num = tonumber(text:match("[%d%.]+"))
	if not num then return 0 end

	if text:find("B") then
		return num * 1_000_000_000
	elseif text:find("M") then
		return num * 1_000_000
	end

	return num
end

-- ===== GUI =====
local controlGui = Instance.new("ScreenGui", gui)
controlGui.Name = "AutoServerGUI"

local toggle = Instance.new("TextButton", controlGui)
toggle.Size = UDim2.fromScale(0.18, 0.07)
toggle.Position = UDim2.fromScale(0.8, 0.45)
toggle.Text = "AUTO: OFF"
toggle.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
toggle.TextScaled = true

toggle.MouseButton1Click:Connect(function()
	AUTO_ENABLED = not AUTO_ENABLED
	if AUTO_ENABLED then
		toggle.Text = "AUTO: ON"
		toggle.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
	else
		toggle.Text = "AUTO: OFF"
		toggle.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
	end
end)

-- ===== JOIN BUTTON =====
local joinGui = Instance.new("TextButton", controlGui)
joinGui.Size = UDim2.fromScale(0.22, 0.08)
joinGui.Position = UDim2.fromScale(0.76, 0.55)
joinGui.Text = "JOIN"
joinGui.Visible = false
joinGui.TextScaled = true
joinGui.BackgroundColor3 = Color3.fromRGB(0, 120, 255)

local currentJoinButton = nil

joinGui.MouseButton1Click:Connect(function()
	if currentJoinButton then
		print("[Auto] Ejecutando JOIN real")
		currentJoinButton:MouseButton1Click()
	end
end)

-- ===== SCAN =====
local function scanServers()
	if not AUTO_ENABLED then return end

	local bestValue = 0
	local bestFrame = nil
	local scanned = 0

	print("----- [Auto] Escaneando servidores -----")

	for _, child in ipairs(scrolling:GetChildren()) do
		if child:IsA("Frame") and scanned < MAX_SERVERS_SCAN then
			scanned += 1

			local valueLabel = child:FindFirstChildWhichIsA("TextLabel")
			if valueLabel then
				local raw = valueLabel.Text or valueLabel.ContentText
				local value = parseValue(raw)

				print("[Scan #" .. scanned .. "]", raw)

				if value > bestValue then
					bestValue = value
					bestFrame = child
				end
			end
		end
	end

	if not bestFrame or bestValue == 0 then
		print("[Auto] No se encontró servidor válido.")
		return
	end

	if lastJoinedValue == bestValue then
		print("[Auto] Servidor ya usado:", bestValue)
		return
	end

	local inner = bestFrame:FindFirstChildWhichIsA("Frame")
	if not inner then return end

	local joinBtn = inner:FindFirstChildWhichIsA("TextButton")
	if not joinBtn then return end

	lastJoinedValue = bestValue
	currentJoinButton = joinBtn

	local display =
		bestValue >= 1_000_000_000 and
		(tostring(bestValue / 1_000_000_000) .. "B")
		or
		(tostring(bestValue / 1_000_000) .. "M")

	joinGui.Text = "JOIN " .. display
	joinGui.Visible = true

	print("[Auto] Mejor servidor:", display)
end

-- ===== REFRESH LISTENER =====
scrolling.ChildAdded:Connect(function()
	task.wait(0.2)
	scanServers()
end)


