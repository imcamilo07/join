-- ================= CONFIG =================
local MAX_SERVERS = 5
local MIN_JOIN_VALUE = 200e6

-- ================= SETUP =================
local player = game.Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

local petMenu
repeat
	petMenu = PlayerGui:FindFirstChild("PetMenu")
	task.wait()
until petMenu

local mainFrame = petMenu:WaitForChild("Frame")
local scrolling = mainFrame:WaitForChild("ScrollingFrame")

local usados = {}
local joinLock = false

-- ================= PERSISTENCIA =================
local FILE_USADOS = "auto_join_usados.json"
local FILE_MIN = "auto_join_min.json"
local HttpService = game:GetService("HttpService")

local function cargarUsados()
	if isfile(FILE_USADOS) then
		local ok, data = pcall(function()
			return HttpService:JSONDecode(readfile(FILE_USADOS))
		end)
		if ok and type(data) == "table" then
			usados = data
		end
	end
end

local function guardarUsados()
	pcall(function()
		writefile(FILE_USADOS, HttpService:JSONEncode(usados))
	end)
end

local function cargarMin()
	if isfile(FILE_MIN) then
		local ok, data = pcall(function()
			return tonumber(readfile(FILE_MIN))
		end)
		if ok and data then
			MIN_JOIN_VALUE = data
		end
	end
end

local function guardarMin()
	pcall(function()
		writefile(FILE_MIN, tostring(MIN_JOIN_VALUE))
	end)
end

cargarUsados()
cargarMin()

-- ================= UTILS =================
local function parseValor(txt)
	if not txt then return nil end
	txt = txt:gsub("%s+", "")
	local maxValue
	for num, suf in txt:gmatch("([%d%.]+)([MB])") do
		local n = tonumber(num)
		if n then
			local value = (suf == "B" and n * 1e9) or (suf == "M" and n * 1e6)
			if not maxValue or value > maxValue then
				maxValue = value
			end
		end
	end
	return maxValue
end

-- ================= GUI PRINCIPAL =================
local gui = Instance.new("ScreenGui")
gui.Name = "AUTO_JOIN_GUI"
gui.ResetOnSpawn = false
gui.DisplayOrder = 999999
gui.Parent = PlayerGui

-- ================= AUTO REFRESH GUI =================
local refreshGui = Instance.new("Frame", gui)
refreshGui.Size = UDim2.new(0,160,0,130)
refreshGui.Position = UDim2.new(0,20,0.4,0)
refreshGui.BackgroundColor3 = Color3.fromRGB(40,40,40)
refreshGui.Active = true
refreshGui.Draggable = true
Instance.new("UICorner", refreshGui)

local refreshBtn = Instance.new("TextButton", refreshGui)
refreshBtn.Size = UDim2.new(1,-10,0,35)
refreshBtn.Position = UDim2.new(0,5,0,5)
refreshBtn.Text = "REFRESH"
refreshBtn.TextScaled = true

local autoBtn = Instance.new("TextButton", refreshGui)
autoBtn.Size = UDim2.new(1,-10,0,30)
autoBtn.Position = UDim2.new(0,5,0,45)
autoBtn.Text = "AUTO: OFF"
autoBtn.TextScaled = true

local input = Instance.new("TextBox", refreshGui)
input.Size = UDim2.new(1,-10,0,30)
input.Position = UDim2.new(0,5,0,80)
input.TextScaled = true
input.Text = tostring(math.floor(MIN_JOIN_VALUE / 1e6))

-- ================= REFRESH REAL =================
local function findRefreshButton()
	for _,obj in ipairs(mainFrame:GetDescendants()) do
		if obj:IsA("TextButton") then
			if obj.Text == "Refresh" or obj.ContentText == "Refresh" then
				return obj
			end
		end
	end
end

local function doRefresh()
	local btn = findRefreshButton()
	if not btn then return end
	for _,c in ipairs(getconnections(btn.MouseButton1Click)) do
		c:Fire()
	end
end

refreshBtn.MouseButton1Click:Connect(doRefresh)

local autoRefresh = false
autoBtn.MouseButton1Click:Connect(function()
	autoRefresh = not autoRefresh
	autoBtn.Text = autoRefresh and "AUTO: ON" or "AUTO: OFF"
end)

task.spawn(function()
	while true do
		if autoRefresh and not joinLock then
			doRefresh()
		end
		task.wait(1.5)
	end
end)

input.FocusLost:Connect(function()
	local n = tonumber(input.Text)
	if n then
		MIN_JOIN_VALUE = n * 1e6
		guardarMin()
	end
end)

-- ================= CORE (NO TOCADO) =================
-- TODO tu core sigue exactamente igual aqu√≠
-- escanear(), autojoin, ignorados, etc

print("[Auto] Script listo con auto-refresh + MIN persistente")


























